cmake_minimum_required (VERSION 2.6)
project(cd3)

if (${CMAKE_CXX_COMPILER_ID} STREQUAL MSVC)
	message(STATUS "Using Visual C compilers")
	set(CMAKE_CXX_FLAGS "/EHsc")
endif()
if (${CMAKE_CXX_COMPILER_ID} STREQUAL GNU)
	message(STATUS "Using GNU compilers")
	set(CMAKE_CXX_FLAGS "-g -Wall")
endif()

find_package(Qt4 REQUIRED)

message(STATUS ${CMAKE_CXX_COMPILER_ID})
set(QT_USE_QTXML true)
set(QT_USE_QTGUI true)
set(QT_USE_QTSVG true)
add_definitions(-DQT_NO_KEYWORDS)
INCLUDE(${QT_USE_FILE})
set(LIBRARY_OUTPUT_PATH ${cd3_BINARY_DIR})
set(EXECUTABLE_OUTPUT_PATH ${cd3_BINARY_DIR})


find_package(PythonLibs)

if (PYTHONLIBS_FOUND AND NOT PYTHON_DISABLED)
	set(CD3_FRONTEND_LIBS cd3core pycd3) #CD3_FRONTEND_LIBS is use for app and cd3-gui
	MESSAGE(STATUS "Python support enabled")
	INCLUDE_DIRECTORIES(src/cd3core src/cd3core/qs src/python)
	set(BOOST_COMPONENTS system signals program_options thread python date_time filesystem)
else()
	MESSAGE(STATUS "Python support disabled")
	add_definitions(-DPYTHON_DISABLED)
	set(CD3_FRONTEND_LIBS cd3core)
	INCLUDE_DIRECTORIES(src/cd3core src/cd3core/qs)
	set(BOOST_COMPONENTS system signals program_options thread date_time filesystem)
endif()

find_package(Boost 1.38.0 COMPONENTS ${BOOST_COMPONENTS} REQUIRED)
set(Boost_USE_STATIC_LIBS ON)
add_definitions(${Boost_LIB_DIAGNOSTIC_DEFINITIONS})
set(Boost_USE_MULTITHREADED ON)
include_directories(${Boost_INCLUDE_DIRS})
link_directories(${Boost_LIBRARY_DIRS})

if (UNIX)
	find_package(OpenMP REQUIRED)
	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
endif()

if (CMAKE_BUILD_TYPE STREQUAL Debug)
	message(STATUS Debug)
	add_definitions(-DDEBUG)
else ()
	message(STATUS Release)
endif()

find_package(GTest QUIET)

add_subdirectory(src/cd3core)
add_subdirectory(src/nodes)
add_subdirectory(src/gui)
if (PYTHONLIBS_FOUND AND NOT PYTHON_DISABLED)
add_subdirectory(src/python)
endif()
add_subdirectory(src/app)
#add_subdirectory(src/plugindoc)

if (GTEST_FOUND)
	message(STATUS "Tests enabled")
	enable_testing(true)
	add_subdirectory(src/tests)
endif()
INCLUDE(Cd3CPack.txt)
